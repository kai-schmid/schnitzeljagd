<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        h1 {
            text-align: center;
        }

        div {
            margin-bottom: 10px;
        }

        label {
            font-weight: bold;
        }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 5px;
        }

        button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #jsonList {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
        }

        #jsonList>div {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }

        #jsonList input[type="number"],
        #jsonList input[type="text"],
        #jsonList select {
            width: 80%;
        }

        #jsonList button {
            position: relative;
        }

        details,
        #jsonOutput {
            margin-top: 20px;
            white-space: pre-wrap;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 20px;
        }

        .error-text {
            color: red;
            margin-top: 5px;
        }
    </style>
    <script>
        const jsonArray = [];

        function addToJsonArray() {
            const name = document.getElementById("name").value;
            const question = document.getElementById("question").value;
            const latitudeText = document.getElementById("latitude").value.replace(',', '.');
            const longitudeText = document.getElementById("longitude").value.replace(',', '.');
            const latitude = parseFloat(latitudeText);
            const longitude = parseFloat(longitudeText);
            const answers = document.getElementById("answers").value.split(",");
            const answerType = document.getElementById("answerType").value;

            if (!validateInputs(name, question, answers, latitude, longitude)) {
                return;
            }

            const newElement = {
                id: generateId(),
                name,
                question,
                coordinates: { latitude, longitude },
                answers,
                answerType
            };

            jsonArray.push(newElement);

            document.getElementById("name").value = "";
            document.getElementById("question").value = "";
            document.getElementById("latitude").value = "";
            document.getElementById("longitude").value = "";
            document.getElementById("answers").value = "";

            displayJsonList();
        }

        function validateInputs(name, question, answers, latitude, longitude) {
            let isValid = true;
            const errorText = document.getElementById("errorText");
            errorText.textContent = "";

            if (!name || !question || !answers || isNaN(latitude) || isNaN(longitude)) {
                errorText.textContent = "Bitte füllen Sie alle Felder korrekt aus.";
                isValid = false;
            } else if (latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {
                errorText.textContent = "Breitengrad muss zwischen -90 und 90 liegen, Längengrad zwischen -180 und 180.";
                isValid = false;
            }

            return isValid;
        }

        function generateId() {
            // Hier kannst du eine Logik zum Generieren einer eindeutigen ID einfügen.
            // In diesem Beispiel verwenden wir eine einfache Zählung.
            return jsonArray.length + 1;
        }



        function displayJsonList() {
            generateJson();
            const jsonList = document.getElementById("jsonList");
            jsonList.innerHTML = ""; // Leeren der Anzeige

            jsonArray.forEach((element, index) => {
                const div = document.createElement("div");
                div.innerHTML = `
                            <div>
                             Station ${index + 1}:
                             </div>
                            <div>
                                Frage: ${element.question}
                            </div>
                            <div>
                                Koordinaten: (${element.coordinates.latitude}, ${element.coordinates.longitude})
                            </div>
                            <div>
                                Antworttyp: ${element.answerType}
                            </div>
                            <div>
                                Antworten: ${element.answers.join(", ")}
                            </div>
                            <button onclick="editJson(${index})">Bearbeiten</button>
                            <button onclick="deleteJson(${index})">Löschen</button>
                        `;
                jsonList.appendChild(div);
            });
        }

        let editingIndex = -1; // Variable, um den Index des gerade bearbeiteten Elements zu speichern

        function editJson(index) {
            editingIndex = index;

            const element = jsonArray[index];
            const questionDiv = document.querySelector(`#jsonList div:nth-child(${index + 1}) div:nth-child(1)`);
            const latitudeDiv = document.querySelector(`#jsonList div:nth-child(${index + 1}) div:nth-child(2)`);
            const longitudeDiv = document.querySelector(`#jsonList div:nth-child(${index + 1}) div:nth-child(3)`);
            const answersDiv = document.querySelector(`#jsonList div:nth-child(${index + 1}) div:nth-child(4)`);
            const answerTypeDiv = document.querySelector(`#jsonList div:nth-child(${index + 1}) div:nth-child(5)`);

            questionDiv.innerHTML = `<input type="text" id="editedQuestion" value="${element.question}">`;
            latitudeDiv.innerHTML = `<input type="text" id="editedLatitude" value="${element.coordinates.latitude}">`;
            longitudeDiv.innerHTML = `<input type="text" id="editedLongitude" value="${element.coordinates.longitude}">`;
            answersDiv.innerHTML = `<input type="text" id="editedAnswers" value="${element.answers.join(", ")}">`;
            answerTypeDiv.innerHTML = `
                    <select id="editedAnswerType">
                        <option value="text" ${element.answerType === "text" ? "selected" : ""}>Text</option>
                        <option value="multipleChoice" ${element.answerType === "multipleChoice" ? "selected" : ""}>Multiple Choice</option>
                    </select>
                `;

            const editButton = document.querySelector(`#jsonList div:nth-child(${index + 1}) button:nth-child(6)`);
            editButton.innerHTML = "Speichern";
            editButton.onclick = saveJson;
        }

        function saveJson() {
            if (editingIndex === -1) return;

            const editedQuestion = document.getElementById("editedQuestion").value;
            const editedLatitude = document.getElementById("editedLatitude").value;
            const editedLongitude = document.getElementById("editedLongitude").value;
            const editedAnswers = document.getElementById("editedAnswers").value.split(",");
            const editedAnswerType = document.getElementById("editedAnswerType").value;

            const editedElement = {
                question: editedQuestion,
                coordinates: { latitude: editedLatitude, longitude: editedLongitude },
                answers: editedAnswers,
                answerType: editedAnswerType
            };

            jsonArray[editingIndex] = editedElement;
            editingIndex = -1;

            // Aktualisieren der JSON-Anzeige
            displayJsonList();
        }

        function deleteJson(index) {
            jsonArray.splice(index, 1);
            // Aktualisieren der JSON-Anzeige nach dem Löschen
            displayJsonList();
        }

        function generateJson() {
            const jsonOutput = document.getElementById("jsonOutput");
            jsonOutput.textContent = JSON.stringify(jsonArray, null, 2);
        }

        function loadJson() {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const jsonContent = event.target.result;
                    try {
                        const parsedJson = JSON.parse(jsonContent);
                        jsonArray.push(...parsedJson);
                        displayJsonList();
                    } catch (error) {
                        alert("Fehler beim Parsen der JSON-Datei.");
                    }
                };
                reader.readAsText(file);
            }
        }

        function downloadJson() {
            const jsonContent = JSON.stringify(jsonArray, null, 2);
            const blob = new Blob([jsonContent], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "data.json";
            a.style.display = "none";
            document.body.appendChild(a);

            a.click();

            URL.revokeObjectURL(url);
        }

        // Anzeigen der vorhandenen Informationen beim Laden der Seite
        displayJsonList();
    </script>
    <title>JSON Editor</title>

</head>

<body>
    <h1>JSON Editor</h1>

    <input type="file" id="fileInput" accept=".json">
    <button onclick="loadJson()">JSON hochladen</button>

    <div>
        <label for="name">Name:</label>
        <input type="text" id="name">
    </div>

    <div>
        <label for="question">Frage:</label>
        <input type="text" id="question">
    </div>

    <div>
        <label for="latitude">Breitengrad:</label>
        <input type="text" id="latitude">
    </div>

    <div>
        <label for="longitude">Längengrad:</label>
        <input type="text" id="longitude">
    </div>

    <div>
        <label for="answers">Antworten (durch Kommas getrennt):</label>
        <input type="text" id="answers">
    </div>

    <div>
        <label for="answerType">Antworttyp:</label>
        <select id="answerType">
            <option value="text">Text</option>
            <option value="multipleChoice">Multiple Choice</option>
        </select>
    </div>

    <button onclick="addToJsonArray()">Hinzufügen</button>

    <div id="jsonList">
        <!-- Hier werden die JSON-Boxen angezeigt -->
    </div>

    <details>
        <summary>JSON-Output:</summary>
        <pre id="jsonOutput"></pre>
    </details>

    <button onclick="downloadJson()">JSON herunterladen</button>
</body>

</html>